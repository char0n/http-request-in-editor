================================================================================
requests-file: multiple body-less requests
================================================================================
###
POST http://www.example.com
Header: test

###
POST http://www.example.com
Header: test

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (headers
      (header-field
        (field-name)
        (field-value))))
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
requests-file: multiple requests
================================================================================
###
GET http://www.example.com

MESSAGE BODY

<> ./file.json

###
GET http://www.example.com

MESSAGE BODY



<> ./file.json



###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-ref
      (file-path)))
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (message-body
      (messages
        (message-line)
        (message-line)
        (message-line)
        (message-line)))
    (response-ref
      (file-path))))

================================================================================
requests-file: multiple requests with comments
================================================================================
# test
### test

#test

GET http://www.example.com
Header1: value1
# test
Header2: value2

body

> {% script %}
<> file.json

# test

# test
###
GET http://www.example.com

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (headers
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-handler
      (handler-script))
    (response-ref
      (file-path)))
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))))

================================================================================
requests-file: multiple requests with multiple comment types
================================================================================
// test
### test

//test

GET http://www.example.com
Header1: value1
// test
Header2: value2

body

> {% script %}
<> file.json

// test

// test
###
GET http://www.example.com

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (headers
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-handler
      (handler-script))
    (response-ref
      (file-path)))
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))))

================================================================================
request: simple request
================================================================================
POST https://httpbin.org/post

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))))

================================================================================
request: simple request with comment
================================================================================
### test
POST https://httpbin.org/post

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))))

================================================================================
request: simple request with comment and http-version
================================================================================
### test
POST https://httpbin.org/post HTTP/1.1

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))))

================================================================================
request: simple request with http-version
================================================================================
POST https://httpbin.org/post HTTP/1.1

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))))

================================================================================
request: simple request with 2.0 http-version
================================================================================
### test
POST https://httpbin.org/post HTTP/2.0

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))))

================================================================================
request: simple request with 1.0 http-version and starting with new line
================================================================================

POST https://httpbin.org/post HTTP/1.0

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))))

================================================================================
request: simple request with 2.0 http-version and starting with new line
================================================================================

POST https://httpbin.org/post HTTP/2.0

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))))

================================================================================
request: simple request starting with two new lines
================================================================================


POST https://httpbin.org/post HTTP/1.0

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))))

================================================================================
request: simple request starting with comment and two new lines
================================================================================
### test


POST https://httpbin.org/post HTTP/1.1

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))))

================================================================================
request: request starting with empty line and having single header
================================================================================

POST https://httpbin.org/post HTTP/1.1
Authorization: token

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
request: request starting with 2 empty lines and having single header
================================================================================


POST https://httpbin.org/post HTTP/1.1
Authorization: token

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
request: request starting comment, 2 empty lines and having single header
================================================================================
### test


POST https://httpbin.org/post HTTP/1.1
Authorization: token

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
request: request starting with comment, 2 empty lines with header and body
================================================================================
### test


POST https://httpbin.org/post HTTP/1.1
Authorization: token

MESSAGE_BODY

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))
    (headers
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (message-line)))))

================================================================================
request: request starting with 2 empty lines having header and body
================================================================================


POST https://httpbin.org/post HTTP/1.1
Authorization: token

MESSAGE_BODY

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)))))
      (http-version))
    (headers
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (message-line)))))

================================================================================
request: request starting directly with request-line
================================================================================
POST https://httpbin.org/post
Authorization: token

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
request: request starting directly with request-separator
================================================================================
### separator
POST https://httpbin.org/post
Authorization: token

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
request: request starting directly with request-separator having a message body
================================================================================
### separator
POST https://httpbin.org/post
Authorization: token

Message body

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (message-line)))))

================================================================================
request: request starting with empty line and explicit request-separator
================================================================================

### separator
POST https://httpbin.org/post
Authorization: token

Message body

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (message-line)))))

================================================================================
request: request containing just request-target
================================================================================
http://www.example.com

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))))

================================================================================
request: request with line comment between request-line and headers
================================================================================
POST http://www.example.com HTTP/2.0
# line comment
Authorization: token

###
--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name))))))
      (http-version))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
request-target: ipv4
================================================================================
GET http://127.0.0.1

###
--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))))

================================================================================
request-target: ipv4 with port
================================================================================
GET http://127.0.0.1:8080

###
--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name))
              (literal)
              (port))))))))

================================================================================
request-target: ipv6-address
================================================================================
GET http://[::1]

###
--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (literal)
                (ipv6-address)
                (literal)))))))))

================================================================================
request-target: ipv6-address with port
================================================================================
GET http://[::1]:8080

###
--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (literal)
                (ipv6-address)
                (literal))
              (literal)
              (port))))))))

================================================================================
request-target: reg-name
================================================================================
GET http://example.com

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))))

================================================================================
request-target: reg-name with port
================================================================================
GET http://example.com:8080

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name))
              (literal)
              (port))))))))

================================================================================
request-target: reg-name with query
================================================================================
GET http://example.com/api/get?id=42

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)
              (path-separator)
              (segment)))
          (literal)
          (query))))))

================================================================================
request-target: reg-name with port and query
================================================================================
GET http://example.com:8080/api/get?id=42

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name))
              (literal)
              (port))
            (absolute-path
              (path-separator)
              (segment)
              (path-separator)
              (segment)))
          (literal)
          (query))))))

================================================================================
request-target: reg-name with query & fragment
================================================================================
GET http://example.com/api/get?id=42#fragment

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)
              (path-separator)
              (segment)))
          (literal)
          (query)
          (literal)
          (fragment))))))

================================================================================
request-target: query with new lines
================================================================================
GET http://example.com/api/get
 ?id=42
 &id2=2

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)
              (path-separator)
              (segment)
              (path-separator)
              (segment)))
          (literal)
          (query))))))

================================================================================
request-target: query with new lines & fragment
================================================================================
GET http://example.com/api/get
 ?id=42
 &id2=2
 #fragment

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)
              (path-separator)
              (segment)
              (path-separator)
              (segment)))
          (literal)
          (query)
          (literal)
          (fragment))))))

================================================================================
request-target: query with new lines & fragment with new lines
================================================================================
GET http://example.com/api/get
 ?id=42
 &id2=2
 #fragment1
 fragment2

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment)
              (path-separator)
              (segment)
              (path-separator)
              (segment)))
          (literal)
          (query)
          (literal)
          (fragment))))))

================================================================================
request-target: no method
================================================================================
http://www.example.com
Host:http://example.com:8080
Host: http://example.com:8080
Host:
Host: value

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (headers
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value)))))

================================================================================
request-target: asterisk-form
================================================================================
OPTIONS * HTTP/1.1
Host: http://example.com:8080

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (asterisk-form))
      (http-version))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
headers: single header
================================================================================
POST https://httpbin.org/post
Authorization: token

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value)))))

================================================================================
headers: multiple headers
================================================================================
POST https://httpbin.org/post
Authorization: token
Content-Type: application/json

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value)))))

================================================================================
headers: multiline header-field
================================================================================
GET http://www.example.com
Header1:
 value1
Header2:
   value2

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (headers
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value)))))

================================================================================
headers: mixing multiline and single line header-field
================================================================================
POST https://httpbin.org/post
Authorization: token
Header1:
 value1
Header2:
   value2

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value))
      (header-field
        (field-name)
        (field-value)))))

================================================================================
message-body: single line message-body
================================================================================
### separator
POST https://httpbin.org/post
Authorization: token

MESSAGE BODY

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (message-line)))))

================================================================================
message-body: input-file-ref between two message-line(s)
================================================================================
POST https://httpbin.org/post
Authorization: token

{}
< ./file.json
{}

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))
            (absolute-path
              (path-separator)
              (segment))))))
    (headers
      (header-field
        (field-name)
        (field-value)))
    (message-body
      (messages
        (message-line)
        (input-file-ref
          (file-path))
        (message-line)
        (message-line)))))

================================================================================
message-body: message-body followed by a response-handler file-path
================================================================================
###
GET http://www.example.com

MESSAGE BODY

> ./file.js

###
--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-handler
      (file-path))))

================================================================================
message-body: message-body followed by a response-handler handler-script
================================================================================
###
GET http://www.example.com

MESSAGE BODY

> {% script %}

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-handler
      (handler-script))))

================================================================================
message-body: message-body followed by a response-ref
================================================================================
###
GET http://www.example.com

MESSAGE BODY

<> ./file.json

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-ref
      (file-path))))

================================================================================
message-body: message-body followed by handler-script and response-ref
================================================================================
###
GET http://www.example.com

MESSAGE BODY

> {% script %}
<> ./file.json

###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-handler
      (handler-script))
    (response-ref
      (file-path))))

================================================================================
message-body: message-body followed by handler-script and response-ref separated by empty lines
================================================================================
###
GET http://www.example.com

MESSAGE BODY

> {% script %}


<> ./file.json


###

--------------------------------------------------------------------------------

(requests-file
  (request
    (requests-line
      (method)
      (request-target
        (absolute-form
          (scheme)
          (literal)
          (hier-part
            (authority
              (host
                (ipv4-or-reg-name)))))))
    (message-body
      (messages
        (message-line)
        (message-line)))
    (response-handler
      (handler-script))
    (response-ref
      (file-path))))
